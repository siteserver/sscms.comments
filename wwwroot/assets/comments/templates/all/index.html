<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>评论</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <script type="text/javascript" src="/assets/comments/lib/iframe-resizer-3.6.3/iframeResizer.contentWindow.min.js"></script>
  <link href="/sitefiles/assets/lib/elementui/default/index.css" rel="stylesheet" type="text/css" />
  <link href="/sitefiles/assets/css/element-ui.css" rel="stylesheet" type="text/css" />
</head>

<body>
  <div id="main">

    <template v-if="pageType === 'form'">

      <el-table v-if="total" :data="items" stripe style="width: 100%">
        <el-table-column
          label="头像" width="100">
          <template slot-scope="scope">
            <el-link :underline="false" v-on:click="btnViewClick(scope.row.userId)">
              <el-avatar :size="40" :src="scope.row.user.avatarUrl || utils.getAssetsUrl('images/default_avatar.png')"></el-avatar>
            </el-link>
          </template>
        </el-table-column>
        <el-table-column label="评论人" width="160">
          <template slot-scope="scope">
            <el-link :underline="false" type="primary" v-on:click="btnViewClick(scope.row.userId)">{{(scope.row.user.displayName || '匿名用户')}}</el-link>
          </template>
        </el-table-column>
        <el-table-column prop="content" label="评论内容"></el-table-column>
        <el-table-column label="评论时间" align="center" width="160">
          <template slot-scope="scope">
            {{ utils.getFriendlyDate(scope.row.createdDate) }}
          </template>
        </el-table-column>
      </el-table>
      
      <el-row v-if="total" style="margin-top: 15px;">
        <el-col :span="24" align="center">
          <el-pagination
            size="mini"
            background
            v-on:current-change="handleCurrentChange"
            :current-page="page"
            :page-size="pageSize"
            layout="total, prev, pager, next, jumper"
            :total="total">
          </el-pagination>
        </el-col>
      </el-row>

      <div v-if="!isSubmitDisabled">
        <el-alert
          v-if="success && isApprovedByDefault"
          style="margin-top: 20px; padding: 10px"
          title="评论提交成功！"
          :closable="false"
          type="success"
          center
          show-icon>
        </el-alert>
        <el-alert
          v-else-if="success && !isApprovedByDefault"
          style="margin-top: 20px; padding: 10px"
          title="评论提交成功，等待管理员审核！"
          :closable="false"
          type="success"
          center
          show-icon>
        </el-alert>
        <div v-else>
          <el-form size="medium" ref="form" :model="form" label-width="80px" style="margin-top: 15px;">
  
            <el-form-item label="评论" prop="content" :rules="{ required: true, message: '请输入评论' }">
              <el-input
                v-model="form.content"
                type="textarea"
                :autosize="{ minRows: 4, maxRows: 10}">
              </el-input>
            </el-form-item>

            <el-form-item v-if="isCaptcha" label="验证码" prop="captcha" :rules="{ required: true, message: '请输入验证码' }">
              <el-col :span="6">
                <el-input v-model="form.captcha" placeholder="请输入验证码"></el-input>
              </el-col>
              <el-col :span="18">
                <img :src="captchaUrl" v-on:click="apiCaptchaLoad" style="width: 105px; height: 38px; margin-left: 5px;" />
              </el-col>
            </el-form-item>
            
          </el-form>
    
          <el-row style="text-align: center;">
            <el-divider></el-divider>
            <div style="height: 10px"></div>
            <el-button type="primary" size="medium" v-on:click="btnSubmitClick">提 交</el-button>
            <div style="height: 10px"></div>
          </el-row>
        </div>
      </div>

    </template>
    
    <template v-else>
      <el-row style="margin: 10px auto; text-align: center">
        <p>载入中，请稍后...</p>
      </el-row>
    </template>

  </div>
</body>

</html>

<script src="/sitefiles/assets/lib/es6-promise.auto.min.js" type="text/javascript"></script>
<script src="/sitefiles/assets/lib/axios-0.17.1.min.js" type="text/javascript"></script>
<script src="/sitefiles/assets/lib/core-js-3.6.5.min.js" type="text/javascript"></script>
<script src="/sitefiles/assets/lib/lodash-4.17.10.min.js" type="text/javascript"></script>
<script src="/sitefiles/assets/lib/jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/sitefiles/assets/lib/layer/layer-3.1.1.js" type="text/javascript"></script>
<script src="/sitefiles/assets/lib/sweetalert2-7.28.4.all.min.js" type="text/javascript"></script>
<script src="/sitefiles/assets/lib/vue-2.5.16.min.js" type="text/javascript"></script>
<script src="/sitefiles/assets/lib/elementui/index.js"></script>
<script src="/sitefiles/assets/js/plugin.js" type="text/javascript"></script>
<script src="/sitefiles/assets/js/utils.js" type="text/javascript"></script>
<script src="/assets/comments/all.js" type="text/javascript"></script>
